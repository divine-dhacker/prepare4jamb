<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UPDATE | English Vocabulary</title>
    <link rel="shortcut icon" href="../assets/images/Favicon/logo.jpeg" type="image/jpeg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Roboto:wght@400;700&display=swap"
        rel="stylesheet">
    <meta property="og:title" content="UTME English Vocabulary" />
    <meta property="og:description" content="Find the Meaning of a Word Very quickly and Make Sentences faster. Also learn New Vocabularies Everyday" />
    <meta property="og:image" content="https://prepare4jamb.com.ng/favicon.png" />

    <!-- Google tag (gtag.js) -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HK6MJZKB6H"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-HK6MJZKB6H');
</script>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1237477643833389"
     crossorigin="anonymous"></script>
    
    
    
   
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --green: #AED581;
      --green-dark: #8BC34A;
      --green-light: #E8F5E9;
    }
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #F8F8F8;
    }
    .loading-indicator::after {
      content: '';
      display: inline-block;
      width: 1rem;
      height: 1rem;
      border: 3px solid white;
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
      margin-left: 0.5rem;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body class="bg-[#F8F8F8] min-h-screen flex flex-col">

  <!-- Custom Modal -->
  <div id="modal" class="modal">
    <div class="bg-white p-6 rounded-xl shadow-lg max-w-sm w-full mx-4">
      <h3 id="modal-title" class="text-xl font-semibold mb-2 text-gray-800"></h3>
      <p id="modal-message" class="text-gray-600 mb-4"></p>
      <div class="flex justify-end">
        <button id="modal-close" class="bg-[#AED581] hover:bg-[#8BC34A] text-white font-semibold py-2 px-4 rounded-lg">OK</button>
      </div>
    </div>
  </div>

  <header class="bg-[#AED581] p-4 text-white flex items-center justify-between shadow-md z-50 sticky top-0">
    <div class="flex items-center space-x-2">
      <div class="font-bold text-xl">UPDATE — Vocab Builder</div>
    </div>
    <div class="flex items-center space-x-2">
      <button id="btnAbout" class="text-white p-2 rounded-lg hover:bg-white/20 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm11.378-3.917c-.89-.777-2.366-.464-2.602.162-.693 1.897-1.748 2.37-2.445 2.548-.564.145-.929.596-1.005 1.144-.074.552.29.967.828 1.115.706.194 1.423.232 2.119.16.267-.024.52-.163.627-.478.111-.34.06-.668-.073-1.01-.197-.549-.304-.972-.519-1.455-.16-.356-.184-.55-.12.445.54.914 1.293 1.577 2.11 1.834.498.158.986.196 1.488.136.726-.08.974-.35.974-.894v-.567c0-2.029-.982-3.13-2.008-3.411Z" clip-rule="evenodd" /><path d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z" /></svg>
      </button>
      <button id="btnSettings" class="text-white p-2 rounded-lg hover:bg-white/20 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6"><path d="M12.488 9.2a3.75 3.75 0 1 0 0 7.5 3.75 3.75 0 0 0 0-7.5Z" /><path fill-rule="evenodd" d="M3 10.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5A.75.75 0 0 1 3 10.5ZM16.5 3a.75.75 0 0 0-.75.75V5.25a.75.75 0 0 0 1.5 0V3.75a.75.75 0 0 0-.75-.75ZM18 10.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75ZM7.5 3a.75.75 0 0 0-.75.75v1.5a.75.75 0 0 0 1.5 0v-1.5A.75.75 0 0 0 7.5 3ZM19.5 16.5a.75.75 0 0 0-.75.75v1.5a.75.75 0 0 0 1.5 0v-1.5a.75.75 0 0 0-.75-.75ZM6 18a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5A.75.75 0 0 1 6 18ZM7.5 19.5a.75.75 0 0 0-.75.75v1.5a.75.75 0 0 0 1.5 0v-1.5a.75.75 0 0 0-.75-.75ZM16.5 19.5a.75.75 0 0 0-.75.75v1.5a.75.75 0 0 0 1.5 0v-1.5a.75.75 0 0 0-.75-.75ZM12 18a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 0 1.5h-1.5A.75.75 0 0 1 12 18ZM15 7.5a.75.75 0 0 0-.75.75v1.5a.75.75 0 0 0 1.5 0v-1.5A.75.75 0 0 0 15 7.5ZM12 3a.75.75 0 0 0-.75.75v1.5a.75.75 0 0 0 1.5 0v-1.5A.75.75 0 0 0 12 3Z" clip-rule="evenodd" /></svg>
      </button>
    </div>
  </header>

  <div class="flex flex-wrap gap-2 p-3 bg-gray-100 border-b border-gray-200 sticky top-16 z-40" id="classChips">
    <!-- chips populated by JS -->
  </div>

  <main class="w-full max-w-5xl mx-auto p-4 md:p-8 flex-grow">
    <div class="grid grid-cols-1 md:grid-cols-[420px_1fr] gap-4">
      <!-- Left: Form -->
      <section class="bg-white p-6 rounded-2xl shadow-md">
        <h2 class="text-xl font-bold mb-2 text-gray-800">Enter words for the assignment</h2>
        <p class="text-sm text-gray-500 mb-4">Add words one-by-one or paste multiple words. The AI will generate meanings & example sentences based on the class level.</p>

        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700">Words (single-line entries)</label>
          <div id="inputsContainer" class="flex flex-col space-y-2 mt-2">
            <!-- input rows go here -->
          </div>
          <div class="flex space-x-2 mt-4">
            <button id="addWordBtn" class="flex-1 btn bg-[#AED581] text-white hover:bg-[#8BC34A] transition-colors p-2 rounded-lg font-semibold">+ Add word</button>
            <button id="pasteModeBtn" class="flex-1 btn bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors p-2 rounded-lg font-semibold">Paste multiple</button>
            <button id="clearInputsBtn" class="flex-1 btn bg-transparent border-2 border-dashed border-gray-300 text-gray-500 hover:bg-gray-100 transition-colors p-2 rounded-lg font-semibold">Clear</button>
          </div>
        </div>

        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700">Or paste many words (one per line)</label>
          <textarea id="pasteArea" class="w-full h-24 p-2 mt-2 rounded-lg border-2 border-dashed border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#AED581]"></textarea>
          <div class="flex space-x-2 mt-2">
            <button id="importPasteBtn" class="flex-1 btn bg-[#AED581] text-white hover:bg-[#8BC34A] transition-colors p-2 rounded-lg font-semibold">Import lines</button>
          </div>
        </div>

        <div class="flex flex-col space-y-4 mt-6">
          <div class="flex items-center space-x-4">
            <button id="createTableBtn" class="btn flex-1 bg-[#AED581] text-white hover:bg-[#8BC34A] transition-colors p-2 rounded-lg font-semibold">Create Table</button>
            <div class="flex items-center space-x-2 text-sm text-gray-500">
              <span>Generator:</span>
              <div id="genMode" class="px-2 py-1 rounded-full text-xs font-medium bg-[#E8F5E9] text-[#8BC34A] border border-[#AED581]">AI (Gemini)</div>
            </div>
          </div>
          <p class="text-xs text-red-500 text-center" id="api-error"></p>
        </div>
      </section>

      <!-- Right: Preview / Table -->
      <section class="bg-white p-6 rounded-2xl shadow-md overflow-hidden">
        <div class="flex flex-col sm:flex-row justify-between items-center mb-4">
          <h2 class="text-xl font-bold text-gray-800 mb-2 sm:mb-0">Assignment Table</h2>
          <div class="flex items-center space-x-2 flex-wrap justify-center sm:justify-end">
            <button id="downloadCsvBtn" class="btn bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors p-2 rounded-lg font-semibold">Download CSV</button>
            <button id="copyBtn" class="btn bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors p-2 rounded-lg font-semibold">Copy</button>
            <button id="shareBtn" class="btn bg-[#AED581] text-white hover:bg-[#8BC34A] transition-colors p-2 rounded-lg font-semibold">Share</button>
          </div>
        </div>

        <div id="tableWrap" class="overflow-x-auto min-h-[200px] flex items-center justify-center p-4 rounded-xl border-2 border-dashed border-gray-300 text-gray-500 text-center">
          No table yet — create one from the left panel.
        </div>
      </section>
    </div>
  </main>

  <!-- New navigation bar -->
  <nav class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-white p-2 rounded-full shadow-lg flex space-x-2 z-50">
    <button id="homeBtn" class="btn p-2 rounded-full bg-[#AED581] hover:bg-[#8BC34A] transition-colors text-white" onclick="window.location.href='index.html';">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.95-8.95c.38-.38 1.02-.38 1.4 0L21.75 12M4.5 9.75v9a2.25 2.25 0 002.25 2.25h3a2.25 2.25 0 002.25-2.25v-3a.75.75 0 011.5 0v3a2.25 2.25 0 002.25 2.25h3a2.25 2.25 0 002.25-2.25v-9M3.75 6.75h16.5" />
      </svg>
    </button>
    <button id="myListBtn" class="btn p-2 rounded-full bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors" onclick="window.location.href='vocab.html';">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.5C8.686 6.5 6 9.186 6 12.5S8.686 18.5 12 18.5s6-2.686 6-6S15.314 6.5 12 6.5zM12 2a10 10 0 100 20 10 10 0 000-20z" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.5v6.5h6.5" />
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.5 12.5h-3.5" />
      </svg>
    </button>
    <button id="helpBtn" class="btn p-2 rounded-full bg-white border border-gray-300 text-gray-700 hover:bg-gray-100 transition-colors" onclick="window.location.href='policy.html';">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.282 2.8-1.554 4.195-.769 1.144.664 1.77 1.942 1.77 3.235v1.235c0 1.293-.626 2.571-1.77 3.235a3.642 3.642 0 01-4.195-.769M12 21a9 9 0 100-18 9 9 0 000 18z" />
      </svg>
    </button>
  </nav>

  <script type="text/javascript">
    /* =========================================================================
     * FILE GENERATION: This entire code is provided as a single, self-contained
     * HTML file. It includes all necessary CSS and JavaScript.
     * ========================================================================= */
    
    /* =========================================================================
     * SECTION 1: CONFIGURATION & EXTERNAL LIBRARIES
     * This section contains all the variables that need to be configured.
     * ========================================================================= */
    
    // Configuration for Firebase and AI APIs
    const CONFIG = {
      FIREBASE: {
        enabled: true, // Set to true to enable Firebase for sharing
        config: {
          apiKey: "AIzaSyDF9rZesIRYwJ0fFM1Q06X8DfZ1_J7e1Yg",
          authDomain: "buddyz-6781f.firebaseapp.com",
          databaseURL: "https://buddyz-6781f-default-rtdb.europe-west1.firebasedatabase.app",
          projectId: "buddyz-6781f",
          storageBucket: "buddyz-6781f.firebasestorage.app",
          messagingSenderId: "612185808963",
          appId: "1:612185808963:web:7b4387eca1bd2bf5f074f6"
        }
      },
      AI: {
        provider: 'gemini',
        apiKey: 'AIzaSyCYA_qYUQNJFDCaqcIuRneqP1t7f3-mnus', // <-- YOUR GEMINI API KEY HERE
        model: 'gemini-2.0-flash' // <-- The model to use
      }
    };
    
    // Firebase initialization variables
    let firebaseApp = null;
    let firestore = null;
    
    // Function to initialize Firebase dynamically
    async function tryInitFirebase() {
      if (!CONFIG.FIREBASE.enabled) return false;
      if (!CONFIG.FIREBASE.config.apiKey) return false;
      try {
        await loadScript('https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js');
        await loadScript('https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js');
        firebaseApp = firebase.initializeApp(CONFIG.FIREBASE.config);
        firestore = firebase.firestore();
        return true;
      } catch (e) {
        console.warn('Firebase init failed', e);
        return false;
      }
    }
    
    // Helper to load a script
    function loadScript(src) {
      return new Promise((res, rej) => {
        const s = document.createElement('script');
        s.src = src;
        s.onload = res;
        s.onerror = rej;
        document.head.appendChild(s);
      });
    }
    
    /* =========================================================================
     * SECTION 2: APP STATE & UI ELEMENTS
     * Manages all the variables and UI elements.
     * ========================================================================= */
    
    const CLASSES = ['KG', 'P1', 'P2', 'P3', 'P4', 'P5', 'P6', 'Junior Secondary', 'Senior Secondary'];
    let selectedClass = 'P1';
    let words = [];
    let tableData = [];
    
    const elements = {
      chipsWrap: document.getElementById('classChips'),
      inputsContainer: document.getElementById('inputsContainer'),
      pasteArea: document.getElementById('pasteArea'),
      genModeBadge: document.getElementById('genMode'),
      createTableBtn: document.getElementById('createTableBtn'),
      tableWrap: document.getElementById('tableWrap'),
      modal: document.getElementById('modal'),
      modalTitle: document.getElementById('modal-title'),
      modalMessage: document.getElementById('modal-message'),
      modalCloseBtn: document.getElementById('modal-close'),
      apiError: document.getElementById('api-error'),
    };
    
    /* =========================================================================
     * SECTION 3: CORE LOGIC & API INTERACTION
     * Contains the main functions for generating and managing vocabulary data.
     * ========================================================================= */
    
    // Main function to create the vocabulary table
    async function createTableForWords(wordList) {
      elements.apiError.textContent = '';
      elements.createTableBtn.classList.add('loading-indicator');
      elements.createTableBtn.disabled = true;
      
      try {
        elements.genModeBadge.textContent = 'AI: ' + CONFIG.AI.model;
        tableData = await aiGenerateBatch(wordList, selectedClass);
        renderTable(tableData);
      } catch (e) {
        console.error('Failed to create table:', e);
        elements.apiError.textContent = 'Error: ' + e.message;
        tableData = wordList.map(w => ({
          word: w,
          meaning: localMeaning(w, selectedClass),
          sentence: localSentence(w, selectedClass)
        }));
        renderTable(tableData);
        showModal('Generation Failed', 'Could not connect to the AI service. Using local fallback. Please check your API key and connection.');
      } finally {
        elements.createTableBtn.classList.remove('loading-indicator');
        elements.createTableBtn.disabled = false;
      }
    }
    
    // Fallback function for local, non-AI generation
    function localMeaning(word, cls) {
      const w = word.toLowerCase();
      if (cls.startsWith('KG')) return `a simple ${w}`;
      if (cls.startsWith('P1') || cls.startsWith('P2')) return `a ${w} used in daily life`;
      return `a ${w} — an example definition adapted to ${cls}`;
    }
    
    function localSentence(word, cls) {
      if (cls.startsWith('KG')) return `The ${word} is here.`;
      if (cls.startsWith('P1') || cls.startsWith('P2')) return `I see the ${word} on the table.`;
      if (cls.startsWith('P3') || cls.startsWith('P4')) return `She used the ${word} to help her.`;
      return `This sentence uses ${word} in a clear example for ${cls}.`;
    }
    
    // AI Wrapper to handle batching and API calls
    async function aiGenerateBatch(wordList, cls) {
      const batches = [];
      for (let i = 0; i < wordList.length; i += 10) batches.push(wordList.slice(i, i + 10));
      const out = [];
      for (const b of batches) {
        const prompt = makePromptForBatch(b, cls);
        const response = await callGeminiAPI(prompt);
        if (response && Array.isArray(response)) {
          out.push(...response);
        } else if (response && response.items) {
          out.push(...response.items);
        } else {
          throw new Error('Invalid AI response format.');
        }
      }
      return out;
    }
    
    function makePromptForBatch(words, cls) {
      const list = words.map(w => `"${w}"`).join(', ');
      return `You are an educational assistant. For the following words and the target class ${cls}, produce a JSON array of objects. Each object must have three fields: 'word' (the original word), 'meaning' (a short, simple definition), and 'sentence' (a single, clear example sentence using the word). The response must contain only the JSON array. Do not include any other text or explanation. Words: [${list}]`;
    }
    
    // Corrected function to call the Gemini API
    async function callGeminiAPI(prompt) {
      if (!CONFIG.AI.apiKey) throw new Error('No API key configured.');
      if (CONFIG.AI.provider !== 'gemini') throw new Error('Incorrect AI provider.');
      
      const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${CONFIG.AI.model}:generateContent?key=${CONFIG.AI.apiKey}`;
      const payload = {
        contents: [{
          parts: [{
            text: prompt
          }]
        }],
        generationConfig: {
          responseMimeType: "application/json"
        }
      };
    
      const response = await fetch(apiUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      });
    
      if (!response.ok) {
        const error = await response.json();
        throw new Error(error.error.message || 'API request failed');
      }
      
      const result = await response.json();
      const content = result.candidates?.[0]?.content?.parts?.[0]?.text;
      
      if (!content) {
        throw new Error("Empty or malformed response from AI.");
      }
      
      return JSON.parse(content);
    }
    
    /* =========================================================================
     * SECTION 4: UI RENDERING & EVENT LISTENERS
     * Handles all user interface updates and interactions.
     * ========================================================================= */
    
    function renderChips() {
      elements.chipsWrap.innerHTML = '';
      CLASSES.forEach(c => {
        const button = document.createElement('button');
        button.className = `px-4 py-2 rounded-full border border-gray-300 text-sm font-semibold transition-colors
                           ${c === selectedClass ? 'bg-[#AED581] text-white border-[#AED581]' : 'bg-white text-gray-700 hover:bg-gray-100'}`;
        button.textContent = c;
        button.onclick = () => {
          selectedClass = c;
          renderChips();
        };
        elements.chipsWrap.appendChild(button);
      });
    }
    
    function addInputRow(initial = '') {
      const row = document.createElement('div');
      row.className = 'flex space-x-2 items-center';
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Enter word';
      input.value = initial;
      input.className = 'flex-1 p-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#AED581]';
      const removeBtn = document.createElement('button');
      removeBtn.className = 'p-2 text-gray-500 hover:text-red-500 transition-colors';
      removeBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path fill-rule="evenodd" d="M16.5 4.478a.75.75 0 0 1 .491.569l.75 6.75A.75.75 0 0 1 16.5 12h-3.375l-.934 2.802c-.089.267-.245.503-.438.696L9.572 17.5l-.659-.726A.75.75 0 0 0 8 17.06V9.467a3.568 3.568 0 0 1 .53-2.031L9.75 4.674V2.25A.75.75 0 0 1 10.5 1.5h3a.75.75 0 0 1 .75.75v2.424a18.966 18.966 0 0 1 4.745-.668ZM12 4.5a.75.75 0 0 1 .75.75v5.25a.75.75 0 0 1-1.5 0V5.25A.75.75 0 0 1 12 4.5Z" clip-rule="evenodd" /></svg>`;
      removeBtn.onclick = () => row.remove();
      row.appendChild(input);
      row.appendChild(removeBtn);
      elements.inputsContainer.appendChild(row);
      input.focus();
    }
    
    function renderTable(data) {
      tableData = data.slice();
      if (!data.length) {
        elements.tableWrap.innerHTML = '<div class="text-gray-500 p-4 text-center">No table yet — create one from the left panel.</div>';
        return;
      }
      const table = document.createElement('table');
      table.className = 'w-full table-auto border-collapse text-sm';
      const thead = document.createElement('thead');
      thead.innerHTML = `
        <tr class="bg-[#E8F5E9] font-semibold text-gray-700">
          <th class="p-3 text-left border-b-2 border-[#AED581]">Word</th>
          <th class="p-3 text-left border-b-2 border-[#AED581]">Meaning</th>
          <th class="p-3 text-left border-b-2 border-[#AED581]">Sentence</th>
          <th class="p-3 text-left border-b-2 border-[#AED581] w-32">Actions</th>
        </tr>`;
      table.appendChild(thead);
      const tbody = document.createElement('tbody');
      data.forEach((r, idx) => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-[#E8F5E9] transition-colors even:bg-gray-50';
        const tdWord = document.createElement('td');
        tdWord.textContent = r.word;
        tdWord.contentEditable = true;
        tdWord.className = 'p-3 border-b border-gray-200';
        const tdMeaning = document.createElement('td');
        tdMeaning.textContent = r.meaning;
        tdMeaning.contentEditable = true;
        tdMeaning.className = 'p-3 border-b border-gray-200';
        const tdSentence = document.createElement('td');
        tdSentence.textContent = r.sentence;
        tdSentence.contentEditable = true;
        tdSentence.className = 'p-3 border-b border-gray-200';
        const tdActions = document.createElement('td');
        tdActions.className = 'p-3 border-b border-gray-200 space-x-1';
        
        const playWordBtn = document.createElement('button');
        playWordBtn.textContent = '🔈';
        playWordBtn.className = 'text-gray-600 hover:text-[#8BC34A]';
        playWordBtn.onclick = () => speakText(r.word);
        
        const delBtn = document.createElement('button');
        delBtn.textContent = '❌';
        delBtn.className = 'text-gray-600 hover:text-red-600';
        delBtn.onclick = () => {
          tableData.splice(idx, 1);
          renderTable(tableData);
        };
    
        tdActions.appendChild(playWordBtn);
        tdActions.appendChild(delBtn);
        
        tr.appendChild(tdWord);
        tr.appendChild(tdMeaning);
        tr.appendChild(tdSentence);
        tr.appendChild(tdActions);
    
        [tdWord, tdMeaning, tdSentence].forEach((cell, i) => {
          cell.addEventListener('blur', () => {
            tableData[idx][['word', 'meaning', 'sentence'][i]] = cell.textContent.trim();
          });
        });
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      elements.tableWrap.innerHTML = '';
      elements.tableWrap.appendChild(table);
      elements.tableWrap.classList.remove('justify-center', 'items-center', 'border-dashed');
      elements.tableWrap.classList.add('p-0', 'border-0');
    }
    
    // Custom modal to replace alert()
    function showModal(title, message) {
      elements.modalTitle.textContent = title;
      elements.modalMessage.textContent = message;
      elements.modal.style.display = 'flex';
      elements.modalCloseBtn.onclick = () => elements.modal.style.display = 'none';
    }
    
    /* =========================================================================
     * SECTION 5: UTILITIES
     * General purpose functions for sharing, TTS, and downloads.
     * ========================================================================= */
    
    async function shareViaFirebase(data) {
      try {
        const doc = await firestore.collection('sharedTables').add({
          class: selectedClass,
          items: data,
          createdAt: new Date()
        });
        const id = doc.id;
        const url = location.origin + location.pathname + '?shared=' + id;
        await navigator.clipboard.writeText(url);
        showModal('Share Link Copied', `The share link has been copied to your clipboard: ${url}`);
      } catch (e) {
        console.warn(e);
        showModal('Share Failed', 'Could not share via Firebase. Check your connection or configuration.');
      }
    }
    
    function shareViaUrl(data) {
      try {
        const payload = {
          class: selectedClass,
          items: data
        };
        const s = btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
        const url = location.origin + location.pathname + '?d=' + s;
        navigator.clipboard.writeText(url);
        showModal('Share Link Copied', 'The assignment data has been encoded in the URL and copied to your clipboard. This may not work for very large tables.');
      } catch (e) {
        showModal('Share Failed', 'Could not create a share link. The data might be too large.');
      }
    }
    
    function speakText(txt) {
      if (!('speechSynthesis' in window)) {
        showModal('TTS Not Supported', 'Text-to-Speech is not supported in this browser.');
        return;
      }
      const utterance = new SpeechSynthesisUtterance(txt);
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utterance);
    }
    
    function downloadCSV(arr, filename) {
      const rows = [['Word', 'Meaning', 'Sentence'], ...arr.map(r => [r.word, r.meaning, r.sentence])];
      const csv = rows.map(r => r.map(c => `"${(c || '').replace(/"/g, '""')}"`).join(',')).join('\n');
      const blob = new Blob([csv], {
        type: 'text/csv'
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }
    
    function copyToClipboard(txt) {
      navigator.clipboard.writeText(txt).then(() => {
        showModal('Copied!', 'Table copied to clipboard.');
      }).catch(err => {
        console.error('Copy failed:', err);
        showModal('Copy Failed', 'Could not copy to clipboard.');
      });
    }
    
    function generateMarkdownTable(arr) {
      const head = '| Word | Meaning | Sentence |\n|---|---|---|\n';
      const body = arr.map(r => `| ${r.word} | ${r.meaning} | ${r.sentence} |`).join('\n');
      return head + body;
    }
    
    /* =========================================================================
     * SECTION 6: INITIALIZATION & EVENT LISTENERS
     * Sets up the initial state and all event listeners.
     * ========================================================================= */
    
    function collectInputWords() {
      const inputs = Array.from(elements.inputsContainer.querySelectorAll('input[type=text]'));
      return inputs.map(i => i.value.trim()).filter(Boolean);
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      renderChips();
      addInputRow();
      
      const params = new URLSearchParams(location.search);
      if (params.has('d')) {
        try {
          const decoded = decodeURIComponent(escape(atob(params.get('d'))));
          const payload = JSON.parse(decoded);
          if (payload && payload.items) renderTable(payload.items);
        } catch (e) {
          console.warn('URL decode failed', e);
        }
      }
      if (params.has('shared')) {
        if (CONFIG.FIREBASE.enabled) {
          (async () => {
            await tryInitFirebase();
            const id = params.get('shared');
            try {
              const doc = await firestore.collection('sharedTables').doc(id).get();
              if (doc.exists) {
                renderTable(doc.data().items);
              } else {
                showModal('Document Not Found', 'The shared document could not be found.');
              }
            } catch (e) {
              showModal('Loading Error', 'Failed to load the shared document.');
              console.warn(e);
            }
          })();
        }
      }
    
      document.getElementById('addWordBtn').addEventListener('click', () => addInputRow());
      document.getElementById('clearInputsBtn').addEventListener('click', () => elements.inputsContainer.innerHTML = '');
      document.getElementById('importPasteBtn').addEventListener('click', () => {
        const lines = elements.pasteArea.value.split('\n').map(l => l.trim()).filter(Boolean);
        lines.forEach(l => addInputRow(l));
        elements.pasteArea.value = '';
      });
      document.getElementById('createTableBtn').addEventListener('click', async () => {
        const words = collectInputWords();
        if (words.length === 0) {
          showModal('Input Required', 'Please add at least one word to generate a table.');
          return;
        }
        await createTableForWords(words);
      });
      document.getElementById('pasteModeBtn').addEventListener('click', () => elements.pasteArea.focus());
      document.getElementById('downloadCsvBtn').addEventListener('click', () => {
        if (!tableData.length) {
          showModal('No Table', 'There is no table to download. Please create one first.');
          return;
        }
        downloadCSV(tableData, 'ceri-table.csv');
      });
      document.getElementById('copyBtn').addEventListener('click', () => {
        if (!tableData.length) {
          showModal('No Table', 'There is no table to copy. Please create one first.');
          return;
        }
        copyToClipboard(generateMarkdownTable(tableData));
      });
      document.getElementById('shareBtn').addEventListener('click', async () => {
        if (!tableData.length) {
          showModal('No Table', 'There is no table to share. Please create one first.');
          return;
        }
        const firebaseReady = await tryInitFirebase();
        if (firebaseReady) {
          shareViaFirebase(tableData);
        } else {
          shareViaUrl(tableData);
        }
      });
      document.getElementById('btnAbout').addEventListener('click', () => showModal('About UPDATE', 'This is a vocabulary assignment builder. Features: class-based AI generation, TTS, and sharing via URL or Firebase.'));
      document.getElementById('btnSettings').addEventListener('click', () => showModal('Settings', 'You can enable AI and Firebase by editing the CONFIG object directly in the code.'));
    });
  </script>
</body>
</html>

